<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Merchant Console | Veritas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50">
    <nav class="p-4 flex justify-between items-center bg-white border-b border-gray-200">
        <div class="flex items-center gap-2">
            <a href="index.html" class="text-xl font-medium text-blue-600">Veritas</a>
            <span class="text-gray-400">|</span>
            <span class="text-sm font-medium text-gray-600">Merchant Console</span>
        </div>
        <button id="connectBtn" class="btn-google">Connect Wallet</button>
    </nav>

    <main class="max-w-4xl mx-auto mt-12 px-6 grid md:grid-cols-2 gap-8">
        <div class="card-google">
            <h2 class="text-xl font-medium mb-2">Business Setup</h2>
            <p class="text-sm text-gray-500 mb-6">Activate your business on Paseo Asset Hub.</p>
            <div class="space-y-4">
                <input id="bizName" type="text" placeholder="Store Name" class="w-full">
                <input id="bizCat" type="text" placeholder="Category (e.g. Cafe)" class="w-full">
                <button id="regBtn" onclick="registerBusiness()" class="btn-google w-full uppercase text-xs tracking-widest">Register Now</button>
            </div>
            <p id="regSuccess" class="mt-4 text-xs text-green-600 hidden text-center font-medium">âœ“ Registered successfully!</p>
        </div>

        <div class="card-google">
            <h2 class="text-xl font-medium mb-2">Generate QR</h2>
            <p class="text-sm text-gray-500 mb-6">Create a unique code for your customer.</p>
            <div class="space-y-4">
                <input id="receiptId" type="text" placeholder="Receipt Number" class="w-full">
                <button onclick="generateQR()" class="btn-google-outline w-full uppercase text-xs tracking-widest">Generate QR Code</button>
            </div>
            <div id="qrcode" class="mt-6 flex justify-center"></div>
        </div>
    </main>

    <script src="app.js"></script>
    <script>
        async function registerBusiness() {
            const name = document.getElementById('bizName').value;
            const category = document.getElementById('bizCat').value;
            if (!name || !category) return alert("Fields missing");
            try {
                const btn = document.getElementById('regBtn');
                btn.innerText = "Registering...";
                await connectWallet();
                const tx = await contract.registerBusiness(name, category);
                await tx.wait();
                document.getElementById('regSuccess').classList.remove('hidden');
                btn.innerText = "Register Now";
            } catch (e) { alert(e.reason || e.message); }
        }

        async function generateQR() {
            const id = document.getElementById('receiptId').value;
            if(!id) return alert("Enter ID");
            await connectWallet();
            const addr = await signer.getAddress();
            const container = document.getElementById('qrcode');
            container.innerHTML = "";
            const url = `${window.location.origin}/veritas/review.html?business=${addr}&receipt=${encodeURIComponent(id)}`;
            new QRCode(container, { text: url, width: 160, height: 160, colorDark : "#1a73e8" });
        }
    </script>
</body>
</html>
