<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Submit Review | Veritas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen">
    <div class="max-w-md w-full p-6 bg-white card-google">
        <h2 class="text-2xl font-normal mb-6">Write a Review</h2>
        <div class="space-y-4">
            <div id="infoBox" class="p-3 bg-blue-50 rounded text-xs text-blue-800 break-all mb-4">
                Loading business details...
            </div>
            <select id="rating" class="w-full"><option value="5">5 Stars</option><option value="4">4 Stars</option><option value="3">3 Stars</option><option value="2">2 Stars</option><option value="1">1 Star</option></select>
            <textarea id="comment" placeholder="Your experience..." rows="4" class="w-full"></textarea>
            <button id="subBtn" onclick="submitReview()" class="btn-google w-full uppercase text-sm font-medium">Submit On-Chain</button>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const biz = params.get('business');
        const receipt = params.get('receipt');

        if(biz && receipt) {
            document.getElementById('infoBox').innerText = `Business: ${biz}\nReceipt: ${receipt}`;
        }

        async function submitReview() {
            try {
                const btn = document.getElementById('subBtn');
                btn.innerText = "Submitting...";
                await connectWallet();
                const receiptHash = ethers.id(receipt);
                // Inviando al nuovo contratto 0xe17...
                const tx = await contract.postReview(biz, document.getElementById('rating').value, document.getElementById('comment').value, receiptHash, "0x");
                await tx.wait();
                alert("Review Published!");
                window.location.href = "index.html";
            } catch (e) { alert(e.reason || e.message); btn.innerText = "Submit On-Chain"; }
        }
    </script>
</body>
</html>
