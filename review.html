<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8"><title>Lascia Recensione</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
</head>
<body class="flex items-center justify-center min-h-screen">
    <div id="container" class="card-google max-w-md w-full mx-4">
        <h2 class="text-xl font-bold mb-4">Verifica la tua esperienza</h2>
        <div id="storeInfo" class="mb-4 text-sm text-blue-600 italic">Verifica negozio in corso...</div>
        <select id="r" class="mb-4"><option value="5">⭐⭐⭐⭐⭐</option><option value="4">⭐⭐⭐⭐</option><option value="3">⭐⭐⭐</option><option value="2">⭐⭐</option><option value="1">⭐</option></select>
        <textarea id="msg" placeholder="Com'è stata la tua esperienza?" class="mb-4"></textarea>
        <button id="btn" onclick="send()" class="btn-google w-full">Pubblica on-chain</button>
    </div>
    <script src="app.js"></script>
    <script>
        const p = new URLSearchParams(window.location.search);
        const bAddr = p.get('business');
        const rid = p.get('receipt');

        window.onload = async () => {
            await connectWallet();
            const b = await contract.businesses(bAddr);
            if(!b.isActive) {
                document.getElementById('container').innerHTML = "<h1 class='text-red-500'>Store non valido</h1>";
            } else {
                document.getElementById('storeInfo').innerText = `Recensione per: ${b.name}`;
            }
        };

        async function send() {
            const hash = ethers.id(rid);
            const tx = await contract.postReview(bAddr, document.getElementById('r').value, document.getElementById('msg').value, hash, "0x");
            await tx.wait();
            alert("Fatto!"); window.location.href = `store.html?id=${bAddr}`;
        }
    </script>
</body>
</html>
